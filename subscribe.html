<!DOCTYPE html>
<html lang="en" class="h-full bg-white antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscribe - ORA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Preload Protos font for faster loading -->
    <link rel="preload" href="Protos.otf" as="font" type="font/otf" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'Protos';
            src: url('Protos.otf') format('opentype');
            font-weight: 800;
            font-style: normal;
            font-display: swap;
        }
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="min-h-screen antialiased text-slate-900 bg-white">
    <!-- Main Container -->
    <div class="relative z-10 min-h-screen">
        
        <!-- Nav -->
        <header class="sticky top-0 z-50 backdrop-blur supports-[backdrop-filter]:bg-white/60 bg-white/80 border-b border-slate-200/60">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                        <span class="text-lg font-semibold tracking-tight text-slate-900" style="font-family: 'Protos', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; letter-spacing: 1.5px; font-weight: 800;">ORA</span>
                    </a>
                    <a href="/" class="text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors">← Back to Home</a>
                </div>
            </div>
        </header>

        <!-- Content -->
        <section class="pt-32 pb-20">
            <div class="max-w-6xl mx-auto px-6">
                <!-- Loading/Processing State (shown when plan is selected from homepage) -->
                <div id="processingState" class="hidden text-center mb-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mb-4"></div>
                    <h1 class="text-3xl lg:text-4xl text-slate-900 tracking-tight mb-4 font-manrope font-semibold">Preparing your subscription...</h1>
                    <p class="text-lg text-slate-600">Please wait while we set up your checkout.</p>
                </div>

                <!-- Pricing Plans (shown when no plan is pre-selected) -->
                <div id="pricingPlans">
                    <div class="text-center mb-12">
                        <h1 class="text-3xl lg:text-4xl text-slate-900 tracking-tight mb-4 font-manrope font-semibold">Choose Your Plan</h1>
                        <p class="text-lg text-slate-600 mb-8">Select a plan to continue with your subscription</p>
                        
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="pricingGrid">
                        <!-- Creator Essentials -->
                        <div class="relative rounded-2xl border border-slate-200 p-8" style="background: rgba(255, 255, 255, 0.5);" data-plan-id="creator">
                            <div class="mb-8">
                                <h4 class="text-xl font-semibold text-slate-900 mb-2">Creator Essentials</h4>
                                <p class="text-sm text-slate-600 mb-6">Perfect for creators just starting their business journey.</p>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-4xl text-slate-900 font-semibold" id="creator-price">$12.99</span>
                                    <span class="text-sm text-slate-400" id="creator-period">/month</span>
                                </div>
                            </div>
                            <ul class="space-y-4 mb-8">
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Smart Rate Calculator</span>
                                </li>
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Deal Management</span>
                                </li>
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Brand Vault</span>
                                </li>
                            </ul>
                            <button onclick="selectPlan('creator')" class="w-full py-4 px-6 rounded-xl text-sm font-medium text-slate-900 border border-slate-200 hover:border-slate-300 transition-all duration-300 hover:bg-slate-50" style="background: rgba(255, 255, 255, 0.8);">
                                Subscribe
                            </button>
                        </div>

                        <!-- Creator Pro - Featured -->
                        <div class="relative rounded-2xl border border-orange-300 p-8" style="background: rgba(249, 115, 22, 0.05);" data-plan-id="pro">
                            <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                                <span class="px-4 py-1 text-xs font-medium text-slate-900 rounded-full border border-orange-300" style="background: rgba(249, 115, 22, 0.9);">Most Popular</span>
                            </div>
                            <div class="mb-8">
                                <h4 class="text-xl font-semibold text-slate-900 mb-2">Creator Pro</h4>
                                <p class="text-sm text-slate-600 mb-6">For professional creators and growing businesses.</p>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-4xl text-slate-900 font-semibold" id="pro-price">$24.99</span>
                                    <span class="text-sm text-slate-400" id="pro-period">/month</span>
                                </div>
                            </div>
                            <ul class="space-y-4 mb-8">
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Everything in Essentials</span>
                                </li>
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Contract Analysis</span>
                                </li>
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Advanced Analytics</span>
                                </li>
                            </ul>
                            <button onclick="selectPlan('pro')" class="w-full py-4 px-6 rounded-xl text-sm font-medium text-slate-900 border border-orange-300 hover:border-orange-400 transition-all duration-300" style="background: rgba(249, 115, 22, 0.15);">
                                Subscribe
                            </button>
                        </div>

                        <!-- Creator Elite -->
                        <div class="relative rounded-2xl border border-slate-200 p-8" style="background: rgba(255, 255, 255, 0.5);" data-plan-id="premium">
                            <div class="mb-8">
                                <h4 class="text-xl font-semibold text-slate-900 mb-2">Creator Elite</h4>
                                <p class="text-sm text-slate-600 mb-6">For agencies and power users who need it all.</p>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-4xl text-slate-900 font-semibold" id="premium-price">$49.99</span>
                                    <span class="text-sm text-slate-400" id="premium-period">/month</span>
                                </div>
                            </div>
                            <ul class="space-y-4 mb-8">
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Everything in Pro</span>
                                </li>
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Advanced AI Insights</span>
                                </li>
                                <li class="flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500 flex-shrink-0"><path d="m9 12 2 2 4-4"></path><circle cx="12" cy="12" r="10"></circle></svg>
                                    <span class="text-sm text-slate-600">Priority Support</span>
                                </li>
                            </ul>
                            <button onclick="selectPlan('premium')" class="w-full py-4 px-6 rounded-xl text-sm font-medium text-slate-900 border border-slate-200 hover:border-slate-300 transition-all duration-300 hover:bg-slate-50" style="background: rgba(255, 255, 255, 0.8);">
                                Subscribe
                            </button>
                        </div>
                    </div>

                    <!-- Important Subscription Information -->
                    <div class="mt-16 pt-12 border-t border-slate-200">
                        <div class="max-w-3xl mx-auto space-y-6">
                            <!-- Auto-Renewal Disclosure (Required by Apple) -->
                            <div class="bg-slate-50 rounded-xl p-6 border border-slate-200">
                                <h3 class="text-lg font-semibold text-slate-900 mb-3">Subscription Details</h3>
                                <ul class="space-y-2 text-sm text-slate-600">
                                    <li class="flex items-start gap-2">
                                        <span class="text-orange-500 mt-0.5">•</span>
                                        <span><strong>Auto-Renewal:</strong> Your subscription will automatically renew unless cancelled at least 24 hours before the end of the current billing period.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="text-orange-500 mt-0.5">•</span>
                                        <span><strong>Billing:</strong> Payment will be charged to your Apple ID account at the confirmation of purchase.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="text-orange-500 mt-0.5">•</span>
                                        <span><strong>Price Changes:</strong> We reserve the right to change subscription prices with 30 days advance notice.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="text-orange-500 mt-0.5">•</span>
                                        <span><strong>Access:</strong> Subscription unlocks premium features in the ORA app. You must download the app from the App Store to use your subscription.</span>
                                    </li>
                                </ul>
                            </div>

                            <!-- Cancellation Instructions (Required by Apple) -->
                            <div class="bg-slate-50 rounded-xl p-6 border border-slate-200">
                                <h3 class="text-lg font-semibold text-slate-900 mb-3">How to Cancel</h3>
                                <p class="text-sm text-slate-600 mb-3">You can cancel your subscription at any time:</p>
                                <ol class="space-y-2 text-sm text-slate-600 list-decimal list-inside">
                                    <li>Open <strong>Settings</strong> on your iPhone or iPad</li>
                                    <li>Tap your <strong>Apple ID</strong> (your name at the top)</li>
                                    <li>Tap <strong>Subscriptions</strong></li>
                                    <li>Select <strong>ORA</strong></li>
                                    <li>Tap <strong>Cancel Subscription</strong></li>
                                </ol>
                                <p class="text-sm text-slate-600 mt-3">Or manage your subscriptions online at: <a href="https://apps.apple.com/account/subscriptions" target="_blank" rel="noopener noreferrer" class="text-orange-500 underline">apps.apple.com/account/subscriptions</a></p>
                                <p class="text-xs text-slate-500 mt-3"><strong>Note:</strong> Cancellation takes effect at the end of your current billing period. You'll retain access until the period ends.</p>
                            </div>

                            <!-- Refund Policy -->
                            <div class="bg-slate-50 rounded-xl p-6 border border-slate-200">
                                <h3 class="text-lg font-semibold text-slate-900 mb-3">Refunds</h3>
                                <p class="text-sm text-slate-600 mb-2">All subscription purchases are processed through Apple. Refunds are subject to Apple's refund policy and terms.</p>
                                <p class="text-sm text-slate-600">To request a refund, contact <a href="https://support.apple.com/contact" target="_blank" rel="noopener noreferrer" class="text-orange-500 underline">Apple Support</a> or visit <a href="https://reportaproblem.apple.com" target="_blank" rel="noopener noreferrer" class="text-orange-500 underline">reportaproblem.apple.com</a>.</p>
                            </div>

                            <!-- App Store Links -->
                            <div class="bg-slate-50 rounded-xl p-6 border border-slate-200 text-center">
                                <h3 class="text-lg font-semibold text-slate-900 mb-4">Download the ORA App</h3>
                                <p class="text-sm text-slate-600 mb-4">To use your subscription, download the ORA app from the App Store:</p>
                                <a href="https://apps.apple.com/app/ora" target="_blank" rel="noopener noreferrer" class="inline-block mb-4 hover:opacity-80 transition-opacity">
                                    <img src="https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/en-us?size=250x83&releaseDate=2024-01-01" alt="Download on the App Store" class="h-12 mx-auto" style="max-width: 180px;">
                                </a>
                                <p class="text-xs text-slate-500 mt-2">
                                    <a href="https://apps.apple.com/account/subscriptions" target="_blank" rel="noopener noreferrer" class="text-orange-500 underline">Manage your subscriptions</a> in App Store settings
                                </p>
                                <p class="text-xs text-slate-500">Your subscription will be activated once you sign in to the app with the same email address used for purchase.</p>
                            </div>

                            <!-- Legal Links -->
                            <div class="text-center space-y-2 pt-4">
                                <p class="text-xs text-slate-500">
                                    By subscribing, you agree to our 
                                    <a href="/terms-of-service" target="_blank" class="text-orange-500 underline">Terms of Service</a> 
                                    and 
                                    <a href="/privacy-policy" target="_blank" class="text-orange-500 underline">Privacy Policy</a>.
                                </p>
                                <p class="text-xs text-slate-500">
                                    For subscription questions, contact us at 
                                    <a href="mailto:support@my.ora.co" class="text-orange-500 underline">support@my.ora.co</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Get plan and user info from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const planId = urlParams.get('plan') || 'creator';
        const userId = urlParams.get('userId') || 'guest';
        const email = urlParams.get('email') || '';

        // Plan names mapping
        const planNames = {
            'free': 'Free',
            'creator': 'Creator Essentials',
            'pro': 'Creator Pro',
            'premium': 'Creator Elite'
        };

        // Show selected plan notice if coming from app
        if (urlParams.get('plan') && planId !== 'free') {
            const notice = document.getElementById('selectedPlanNotice');
            const noticeText = document.getElementById('selectedPlanText');
            if (notice && noticeText) {
                notice.classList.remove('hidden');
                noticeText.textContent = `You selected ${planNames[planId] || planId} plan in the app`;
            }

            // Highlight the selected plan card
            setTimeout(() => {
                const planCards = document.querySelectorAll('[data-plan-id]');
                planCards.forEach(card => {
                    if (card.getAttribute('data-plan-id') === planId) {
                        // Add a subtle pulse animation
                        card.style.animation = 'pulse 2s ease-in-out';
                        card.style.border = '2px solid rgba(249, 115, 22, 0.5)';
                        setTimeout(() => {
                            card.style.animation = '';
                        }, 2000);
                    }
                });
            }, 100);
        }

        // Validate email format
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email.trim());
        }

        // Check if email exists in Supabase
        async function checkEmailExists(email) {
            try {
                const response = await fetch('https://myora.co/api/check-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email }),
                });

                if (!response.ok) {
                    return { exists: false, error: 'Unable to verify email' };
                }

                const data = await response.json();
                return { exists: data.exists, email: data.email };
            } catch (error) {
                console.error('Error checking email:', error);
                return { exists: false, error: 'Unable to verify email' };
            }
        }

        // Pricing data - Monthly only
        const pricing = {
            creator: 12.99,
            pro: 24.99,
            premium: 49.99
        };

        // Select plan function
        async function selectPlan(plan) {
            // Get user info from URL or prompt
            let currentUserId = urlParams.get('userId') || userId || 'guest';
            let currentEmail = urlParams.get('email') || email;

            // If no email in URL, prompt user
            if (!currentEmail) {
                currentEmail = prompt('Enter the email address you use in the ORA app:');
                if (!currentEmail || !currentEmail.trim()) {
                    alert('Email is required to process your subscription.');
                    return;
                }
            }

            // Validate email format
            if (!isValidEmail(currentEmail)) {
                alert('Please enter a valid email address.');
                return;
            }

            // Check if email already exists (to prevent duplicate accounts)
            const emailCheck = await checkEmailExists(currentEmail);
            if (emailCheck.error) {
                // If check fails, redirect to homepage
                alert('Unable to verify email. Please make sure you use the same email address you use in the ORA app.');
                window.location.href = '/';
                return;
            } else if (emailCheck.exists) {
                // Email exists - this is good, they can subscribe
                console.log('Email found in system, proceeding with checkout');
            } else {
                // Email doesn't exist - redirect to homepage
                alert('This email is not registered in the ORA app. You need to sign up in the app first, or use the email address you already use in the app.');
                window.location.href = '/';
                return;
            }

            // Plan ID (monthly only)
            const planId = plan;

            // Create checkout session
            createCheckoutSession(planId, currentUserId, currentEmail.trim().toLowerCase());
        }

        // Create Stripe Checkout session
        async function createCheckoutSession(planId, userId, email) {
            try {
                const response = await fetch('https://myora.co/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        planId,
                        userId,
                        email,
                    }),
                });

                if (!response.ok) {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'Failed to create checkout session'));
                    return;
                }

                const data = await response.json();
                
                // Redirect to Stripe Checkout
                if (data.url) {
                    window.location.href = data.url;
                } else {
                    alert('Error: No checkout URL received');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to create checkout session. Please try again.');
            }
        }

        // Auto-prompt for email and start checkout if plan is provided in URL
        if (urlParams.get('plan') && planId !== 'free') {
            // Hide pricing plans and show processing state
            document.getElementById('pricingPlans').style.display = 'none';
            document.getElementById('processingState').classList.remove('hidden');
            
            // Auto-start checkout for the selected plan (will prompt for email)
            setTimeout(() => {
                selectPlan(planId);
            }, 500); // Small delay to ensure page is fully loaded
        }
    </script>

    <!-- Vercel Analytics -->
    <script src="https://va.vercel-scripts.com/v1/script.js" defer></script>

    <!-- Vercel Speed Insights -->
    <script src="https://va.vercel-scripts.com/v1/speed-insights/script.js" defer></script>
</body>
</html>

