<!DOCTYPE html>
<html lang="en" class="h-full bg-white antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connecting to ORA - Gmail OAuth</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Preload Protos font for faster loading -->
    <link rel="preload" href="../Protos.otf" as="font" type="font/otf" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'Protos';
            src: url('../Protos.otf') format('opentype');
            font-weight: 800;
            font-style: normal;
            font-display: swap;
        }
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="min-h-screen antialiased text-slate-900 bg-white">
    <!-- Nav -->
    <header class="sticky top-0 z-50 backdrop-blur supports-[backdrop-filter]:bg-white/60 bg-white/80 border-b border-slate-200/60">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between">
                <a href="/" class="flex items-center gap-3">
                    <span class="text-lg font-semibold tracking-tight" style="font-family: 'Protos', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; letter-spacing: 1.5px; font-weight: 800;">ORA</span>
                </a>
                <a href="/" class="text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors">← Back to Home</a>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="relative z-10 min-h-screen flex items-center justify-center px-6 py-20">
        <div class="max-w-2xl w-full">
            <div class="rounded-3xl border border-slate-200 p-12 text-center" style="background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);">
                <div class="mb-8">
                    <div id="iconContainer" class="w-20 h-20 mx-auto mb-6 rounded-full bg-orange-500/10 flex items-center justify-center border border-orange-500/20">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-orange-500">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                    </div>
                    <h1 class="text-3xl lg:text-4xl text-slate-900 tracking-tight mb-4 font-manrope font-semibold" id="mainTitle">Connecting Gmail...</h1>
                    <div id="successMessage" class="hidden bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <p class="text-green-800 text-sm">
                            <strong>✓ OAuth Authorization Successful!</strong><br>
                            The authorization code has been received. This confirms the OAuth flow is working correctly. If you're testing for Google verification, this successful redirect is sufficient proof that the OAuth integration works.
                        </p>
                    </div>
                    
                    <!-- Countdown Timer -->
                    <div id="countdownContainer" class="mb-6">
                        <p class="text-base text-slate-600 mb-3">Redirecting in:</p>
                        <div class="flex items-center justify-center gap-2 mb-4">
                            <div id="countdownNumber" class="text-5xl font-bold text-orange-500 font-manrope" style="min-width: 80px; text-align: center;">5</div>
                            <span class="text-xl text-slate-500">seconds</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <button id="returnToHomeBtn" onclick="redirectToHome()" class="w-full py-4 px-6 rounded-xl text-base font-semibold text-white border border-orange-500 hover:border-orange-600 transition-all duration-300 flex items-center justify-center gap-2" style="background: #f97316;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        Return to Homepage
                    </button>
                    <button id="openAppBtn" onclick="tryOpenApp()" class="w-full py-4 px-6 rounded-xl text-base font-semibold text-slate-700 border border-slate-200 hover:border-slate-300 transition-all duration-300 hover:bg-slate-50 flex items-center justify-center gap-2" style="background: rgba(255, 255, 255, 0.8);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                            <polyline points="10 17 15 12 10 7"></polyline>
                            <line x1="15" y1="12" x2="3" y2="12"></line>
                        </svg>
                        Open ORA App
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';
            
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const error = urlParams.get('error');
            const errorDescription = urlParams.get('error_description');

            const appScheme = 'myora://oauth/callback';
            const homepageUrl = 'https://myora.co';
            let countdownInterval = null;
            let countdown = 5;

            function redirectToHome() {
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
                window.location.href = homepageUrl;
            }

            function tryOpenApp() {
                if (code) {
                    window.location.href = appScheme + '?code=' + encodeURIComponent(code);
                } else if (error) {
                    window.location.href = appScheme + '?error=' + encodeURIComponent(error) + '&error_description=' + encodeURIComponent(errorDescription || 'Authentication failed');
                } else {
                    window.location.href = appScheme;
                }
                
                setTimeout(function() {
                    redirectToHome();
                }, 2000);
            }

            function updateCountdown() {
                const countdownElement = document.getElementById('countdownNumber');
                if (countdownElement) {
                    countdownElement.textContent = countdown;
                }
                
                if (countdown <= 0) {
                    if (countdownInterval) {
                        clearInterval(countdownInterval);
                    }
                    redirectToHome();
                } else {
                    countdown--;
                }
            }

            if (code) {
                document.getElementById('mainTitle').textContent = 'Authorization Successful!';
                document.getElementById('successMessage').classList.remove('hidden');
                
                const iconContainer = document.getElementById('iconContainer');
                iconContainer.classList.remove('bg-orange-500/10', 'border-orange-500/20');
                iconContainer.classList.add('bg-green-500/10', 'border-green-500/20');
                
                const icon = iconContainer.querySelector('svg');
                if (icon) {
                    icon.classList.remove('text-orange-500');
                    icon.classList.add('text-green-500');
                }
            }
            
            if (error) {
                document.getElementById('mainTitle').textContent = 'Authorization Failed';
                document.getElementById('successMessage').classList.remove('hidden');
                document.getElementById('successMessage').classList.remove('bg-green-50', 'border-green-200');
                document.getElementById('successMessage').classList.add('bg-red-50', 'border-red-200');
                document.getElementById('successMessage').querySelector('p').innerHTML = '<strong>✗ OAuth Authorization Failed</strong><br>' + (errorDescription || 'Authentication failed. Please try again.');
                document.getElementById('successMessage').querySelector('p').classList.remove('text-green-800');
                document.getElementById('successMessage').querySelector('p').classList.add('text-red-800');
                
                const iconContainer = document.getElementById('iconContainer');
                iconContainer.classList.remove('bg-orange-500/10', 'border-orange-500/20');
                iconContainer.classList.add('bg-red-500/10', 'border-red-500/20');
                
                const icon = iconContainer.querySelector('svg');
                if (icon) {
                    icon.classList.remove('text-orange-500');
                    icon.classList.add('text-red-500');
                }
            }

            const countdownElement = document.getElementById('countdownNumber');
            if (countdownElement) {
                countdownInterval = setInterval(updateCountdown, 1000);
            }

            if (code && /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                setTimeout(function() {
                    tryOpenApp();
                }, 1000);
            }
        })();
    </script>
</body>
</html>
